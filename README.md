# Guesthouse Marusho Reservation System

ゲストハウスマル正の予約管理システムです。電話予約中心の運用から、オンライン予約（現地現金決済）への移行を目的として構築されています。

## システム概要

- **目的**: 予約業務のオンライン化・効率化
- **ターゲット**: 国内外の旅行者（多言語対応）
- **決済方式**: 現地現金決済（オンライン決済機能なし）
- **特徴**: シンプルな操作性、スマートフォン対応、管理者向け機能の充実

## 機能一覧

### ユーザー向け機能
- **空室検索・予約**: 日付と人数、部屋タイプを指定してリアルタイムに空室を検索・予約。
- **多言語対応**: 日本語 (JA) と英語 (EN) の完全対応。
- **予約管理**:
    - **ゲスト予約**: 会員登録不要で予約可能。予約確認はメールで送付される専用リンク（トークン）からアクセス。
    - **会員予約**: 会員登録することで、マイページから予約履歴の確認やキャンセルが可能。
- **レスポンシブデザイン**: スマートフォン、タブレット、PCに対応。

### 管理者向け機能 (管理画面)
- **ダッシュボード**:
    - 本日のチェックイン予定、未払い予約の件数をひと目で確認。
    - 重要な通知（新規予約など）を表示。
- **予約管理**:
    - 予約一覧の検索・フィルタリング（日付、キーワード）。
    - 予約ステータス（確定/キャンセル）、支払状況（未払/済）、チェックイン状況（待ち/済）の管理。
    - 新規予約の手動作成（電話予約の入力など）。
- **空室カレンダー**:
    - 部屋ごとの予約状況をタイムライン形式で視覚的に確認。
    - ドラッグ＆ドロップやクリックでの直感的な操作（※閲覧中心）。
- **部屋・部屋タイプ管理**:
    - 部屋ごとの料金設定（大人/子供）。
    - 部屋画像のアップロード・管理。
    - 部屋の公開/非公開設定。
- **顧客管理**: 顧客情報の編集、パスワードリセット。

## ディレクトリ構成

プロジェクトは機能ごとに整理されています。

```
/
├── admin/              # 管理者用ページ (認証が必要)
├── api/                # フロントエンド用API (空室状況取得など)
├── assets/             # 静的リソース
│   ├── css/            # スタイルシート (Tailwind CSS, custom CSS)
│   ├── js/             # JavaScriptファイル
│   └── images/         # 画像ファイル (部屋画像など)
├── db_sql/             # データベース定義ファイル (database.sql)
├── includes/           # 共通ライブラリ・設定
│   ├── config.php      # 定数設定
│   ├── db_connect.php  # DB接続
│   ├── functions.php   # 汎用関数 (メール送信など)
│   └── language.php    # 多言語化ロジック
├── lang/               # 言語ファイル (JSON形式)
│   ├── ja.json         # 日本語リソース
│   └── en.json         # 英語リソース
└── [root files]        # 公開ページ (index.php, book.php, rooms.phpなど)
```

## インストール・セットアップ手順

### 1. データベースの構築
MySQLまたはMariaDBデータベースを作成し、以下のSQLファイルを実行してテーブル構造と初期データをインポートしてください。
```bash
mysql -u [username] -p [database_name] < db_sql/database.sql
```

### 2. 接続設定
`includes/db_connect.php` を開き、環境に合わせてデータベース接続情報を編集してください。
```php
$dsn = 'mysql:host=localhost;dbname=guesthouse_marusho;charset=utf8mb4';
$user = 'your_username';
$password = 'your_password';
```

### 3. メール設定 (オプション)
メール送信機能を使用する場合は、`includes/functions.php` 内の `send_email_smtp` 関数にあるSMTP設定（ホスト、ポート、ユーザー名、パスワード）を環境に合わせて更新してください。

### 4. 動作確認
ブラウザでトップページ (`index.php`) にアクセスし、表示されるか確認してください。
管理画面 (`admin/`) には、初期アカウントでログインできます。
- **Email**: `admin@example.com`
- **Password**: (初期パスワードは `database.sql` 内のコメントまたはドキュメントを参照し、初回ログイン後に変更してください)

## 開発者向け情報

- **多言語化**: 新しいテキストを追加する場合は、`lang/ja.json` と `lang/en.json` の両方にキーを追加し、PHP側では `t('key_name')` 関数を使用してください。
- **セキュリティ**:
    - ユーザー入力の出力時は必ず `h()` 関数でエスケープしてください。
    - データベース操作はPDOのプリペアドステートメントを使用してください。
    - 管理画面へのアクセスは `admin/admin_check.php` で保護されています。

## 技術スタック
- **Backend**: PHP 7.4+
- **Database**: MySQL 5.7+ / MariaDB 10.x
- **Frontend**: HTML5, CSS3 (Tailwind CSS CDN), JavaScript
- **Libraries**: FullCalendar (CDN), Google Fonts, Material Icons
