# 機能提案と使いやすさの向上 (Proposal)

本プロジェクト「Guesthouse Marusho」予約システムに対し、以下の改善点を提案します。

## 1. ユーザー体験 (UX) の向上

### レスポンシブデザインの強化
現在、管理画面のテーブル表示などはPC向けに最適化されていますが、スマートフォンやタブレットでの閲覧時にはレイアウトが崩れる可能性があります。
- **提案:** CSSメディアクエリやBootstrapなどのフレームワークを活用し、モバイル端末でも予約状況の確認や承認作業をスムーズに行えるようにする。

### 多言語対応 (i18n)
ゲストハウスという性質上、海外からの旅行者も想定されます。
- **提案:** `lang/` ディレクトリを活用し、英語・中国語・韓国語などの多言語切り替え機能をフロントエンドに実装する。

### 予約フローの改善 (AJAX化)
現在の予約フローはページ遷移を伴いますが、カレンダーから部屋を選択し、モーダルウィンドウで予約を完了できるようなSPA (Single Page Application) 的な挙動を取り入れることで、離脱率を低減できます。

## 2. 管理機能の強化

### レポート・分析機能
売上の推移や稼働率を可視化する機能が不足しています。
- **提案:**
    - 月別・部屋タイプ別の売上グラフ
    - リピーター率の算出
    - キャンセル率の分析
    これらをダッシュボードに表示することで、経営判断に役立てることができます。

### 自動メール通知の拡充
予約確定時だけでなく、以下のタイミングでのメール送信を提案します。
- **リマインダーメール:** チェックイン3日前に自動送信（アクセス案内など）。
- **サンキューメール:** チェックアウト翌日に送信（レビュー依頼など）。

### 権限管理 (RBAC) の細分化
現在は「管理者」か「一般」かの2択ですが、スタッフの役割に応じた権限設定が必要です。
- **提案:**
    - 「予約閲覧のみ可能」な清掃スタッフ用アカウント
    - 「予約操作・顧客管理が可能」なフロントスタッフ用アカウント
    - 「全ての操作が可能」なマネージャー用アカウント

## 3. セキュリティとインフラ

### 監査ログ (Audit Logs)
誰がいつどのデータを操作したかを記録する監査ログ機能の導入。
- `admin_logs` テーブルを作成し、重要な操作（予約キャンセル、顧客削除など）を記録する。

### バックアップの自動化
データベースの定期バックアップを自動化し、障害時の復旧体制を整える。

## 4. 使いやすさ・セキュリティの向上 (追加提案)

### A. セキュリティ強化 (ゲスト予約)
- **現状の課題:** ゲスト予約の完了画面が `confirm.php?booking_id=123` という形式で、IDを推測すれば他人の予約が見れてしまうリスクがありました（今回の改修でセッションチェックを追加しましたが、予約直後の端末でしか見られない制限があります）。
- **提案:** 予約時にランダムな文字列（トークン、例: UUID）を生成し、`booking_token` として `bookings` テーブルに保存します。
- **変更点:** URLを `booking_id=123` ではなく `confirm.php?token=xyz...` のようにします。これにより、URLを知っている人のみがアクセスでき、推測によるアクセスを防げます。

### B. レスポンシブデザイン
- スマートフォンからの管理も想定し、管理画面（`admin/`）のフォームやダッシュボードをモバイル対応にします。

## 実装済みの機能 (今回の対応範囲)

1.  **顧客管理システム (CRM)**
    - `admin/users.php`: 顧客一覧・検索機能
    - `admin/user_detail.php`: 顧客詳細・編集・予約履歴確認
    - データベース拡張: 電話番号 (`phone`)、特記事項 (`notes`) カラムの追加

2.  **空室カレンダー (Visual Calendar)**
    - `admin/calendar.php`: FullCalendarライブラリを使用したリソースタイムライン表示
    - `admin/api/calendar_events.php`: 予約データのJSON配信API
    - インタラクション: 予約済みイベントの編集、空きスロットクリックによる新規予約画面への遷移
