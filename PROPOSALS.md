# 機能提案と改善計画 (Proposals & Roadmap)

本プロジェクト「Guesthouse Marusho」予約システムに対し、現状の実装状況と、専門的視点に基づいた今後の改善提案をまとめます。

## 1. 実装済み機能 (Implemented Features)
以下の機能は既にシステムに実装されています。

### ユーザー体験 (UX) / フロントエンド
- **[Completed] レスポンシブデザイン (Mobile Usability):**
    - `assets/css/style.css` および Tailwind CSS により、スマートフォン・タブレット・PCでの表示に対応済み。
    - FullCalendarの表示モード切替（モバイル: ListWeek, PC: DayGridMonth）を実装済み。
- **[Completed] 多言語対応 (i18n):**
    - `lang/ja.json`, `lang/en.json` と `t()` 関数による日英対応が完了。
- **[Completed] 予約導線の改善:**
    - トップページに「初めての方」「リピーターの方」の誘導ボタンを設置。
    - 予約フォームでのCSRF対策 (`validate_csrf_token`) 実装済み。
    - ゲスト予約時のトークンベースの確認ページ (`confirm.php?token=...`) 実装済み。

### 管理機能 (Admin)
- **[Completed] 権限管理 (RBAC):**
    - `ROLE_MANAGER`, `ROLE_STAFF`, `ROLE_CLEANER` の3段階の権限システムを実装。
    - `admin_check.php` によるページごとのアクセス制御を適用済み。
- **[Completed] 操作ログ (Audit Logging):**
    - `admin_logs` テーブルにより、ログイン、予約作成・変更などの重要操作を記録済み。
- **[Completed] 自動メール通知:**
    - `cron_mail.php` によるリマインダー（3日前）およびサンキューメール（1日後）の自動送信ロジック実装済み。
- **[Completed] 管理ダッシュボード:**
    - Chart.jsを用いた月別売上推移グラフ、本日のチェックイン一覧表示などを実装済み。
- **[Completed] パスワードリセット:**
    - `forgot_password.php` によるセルフサービス型のリセット機能を実装済み。

---

## 2. 推奨される追加機能 (Recommended Updates for Stability & Compliance)
運用の安定性、法的要件、セキュリティを強化するために、以下の機能追加を強く推奨します。

### A. 宿泊者名簿機能の強化 (Legal Compliance)
**重要度: 高 (High)**
- **現状:** 現在のデータベース (`bookings` テーブル) は、代表者（予約者）の氏名・連絡先のみを保存し、同行者は人数 (`num_guests`) のみ管理しています。
- **課題:** 日本の旅館業法（第六条）では、**宿泊者全員**の「氏名・住所・職業」を記載した宿泊者名簿の作成と3年間の保存が義務付けられています。
- **提案:**
    - `booking_guests` テーブルを新規作成し、同行者の詳細情報を保存できるようにする。
    - チェックイン時または予約確認画面で、同行者情報の入力を求めるフォームを追加する（タブレット等の現地入力インターフェース含む）。

### B. データベースの自動バックアップ (Data Safety)
**重要度: 高 (High)**
- **現状:** サーバー上のデータバックアップ機構が含まれていません。
- **リスク:** サーバー障害、誤操作、サイバー攻撃などによりデータが消失した場合、復旧が不可能になります。
- **提案:**
    - 日次で `mysqldump` を実行し、日付付きのSQLファイルを保存するシェルスクリプトを作成する。
    - 可能であれば、バックアップファイルを外部ストレージ（S3や別サーバー）へ転送する仕組みを構築する。

### C. セキュリティ攻撃対策 (Security Hardening)
**重要度: 中 (Medium)**
- **現状:** CSRF対策は実装済みですが、ログイン試行回数の制限（レートリミット）がありません。
- **リスク:** ブルートフォース攻撃（総当たり攻撃）により、管理者パスワードが突破されるリスクがあります。
- **提案:**
    - `login.php` にレートリミット機能を導入する（例: 同一IPからのログイン失敗が5回続いた場合、30分間ロックする）。
    - 予約フォーム (`book.php`) に対しても、短時間の大量投稿を防ぐための簡易的なレートリミットまたはreCAPTCHAの導入を検討する。

---

## 3. 今後の機能拡張案 (Future Enhancements)
緊急性は低いものの、システムの利便性を高めるための提案です。

### UX / 機能
- **予約フローのSPA化:** 画面遷移を減らし、カレンダー選択から完了までをモーダルで完結させる。
- **動的価格設定:** 繁忙期・閑散期に応じた料金変動（シーズナリティ）を管理画面から設定できる機能。
- **清掃管理ビュー:** `ROLE_CLEANER` 向けに、部屋ごとの清掃ステータス（清掃前/清掃中/完了）を管理する専用画面。
