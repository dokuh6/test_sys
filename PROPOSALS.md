# 機能提案と使いやすさの向上

## 1. 機能提案

### A. 顧客管理システム (CRM)
現在、ユーザー管理機能は基本的であり、管理者が詳細に顧客を管理する機能が不足しています。管理者向けの顧客管理システムの導入を提案します。

**提案機能:**
- **管理者ダッシュボード:** 氏名、メールアドレス、予約履歴などでユーザーを検索・一覧表示。
- **ユーザー詳細:** 個々のユーザーのプロフィール、予約履歴、累計支払額、連絡先情報の閲覧。
- **特記事項 (Notes):** 管理者が顧客に関するメモ（例:「ピーナッツアレルギーあり」「VIP」など）を追加できる機能。
- **編集/削除:** ユーザー情報の修正やアカウント停止機能。

**技術的な実装案:**
- `admin/users.php` を作成し、ユーザー一覧を表示。
- `admin/user_detail.php` を作成し、詳細情報の閲覧・編集を可能にする。
- `users` テーブルに `notes` カラムを追加するか、別の `user_notes` テーブルを作成する。

### B. 空室カレンダー
管理者が部屋の稼働状況を一目で確認できるビジュアルカレンダーの導入を提案します。

**提案機能:**
- **月表示:** 日付ごとにセルが分かれたカレンダー表示。
- **部屋ごとの行:** 部屋番号（101, 102...）ごとに行を分ける。
- **予約ブロック:** 予約が入っている日程を色付きのブロックで表示。
- **クイックアクション:** 予約ブロックをクリックして詳細を表示・キャンセルしたり、空きスロットをクリックして新規予約を作成。

**技術的な実装案:**
- **フロントエンド:** **FullCalendar** などのJavaScriptライブラリ、またはCSS Gridを使用したカスタム実装。
- **バックエンド API:** 予約データをJSON形式で返すPHPエンドポイント (`admin/api/calendar_events.php`) を作成。
  ```json
  [
    {
      "id": 123,
      "resourceId": "room_1",
      "title": "ゲスト氏名",
      "start": "2023-10-27",
      "end": "2023-10-29",
      "color": "red" // 確定済み
    }
  ]
  ```
- **UI:** `admin/calendar.php` に統合。

## 2. 使いやすさ・セキュリティの向上

### A. セキュリティ強化 (ゲスト予約)
- **現状の課題:** ゲスト予約の完了画面が `confirm.php?booking_id=123` という形式で、IDを推測すれば他人の予約が見れてしまうリスクがありました（今回の改修でセッションチェックを追加しましたが、予約直後の端末でしか見られない制限があります）。
- **提案:** 予約時にランダムな文字列（トークン、例: UUID）を生成し、`booking_token` として `bookings` テーブルに保存します。
- **変更点:** URLを `booking_id=123` ではなく `confirm.php?token=xyz...` のようにします。これにより、URLを知っている人のみがアクセスでき、推測によるアクセスを防げます。

### B. レスポンシブデザイン
- スマートフォンからの管理も想定し、管理画面（`admin/`）のフォームやダッシュボードをモバイル対応にします。

### C. メール通知
- **管理者通知:** 新規予約が入った際に管理者にメールで通知する機能。
- **パスワードリセット:** ユーザーがパスワードを忘れた際の再設定機能。

### D. 管理画面の多言語化
- スタッフに多国籍なメンバーがいる場合に対応するため、管理画面も多言語表示に対応させます。
